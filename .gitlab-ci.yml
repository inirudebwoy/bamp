default:
  before_script:
    - curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python
    - export PATH=$PATH:$HOME/.poetry/bin

test-py36:
  stage: test
  image: python:3.6
  script:
    - pip install "tox>3,<4"
    - tox -e py36

test-py37:
  stage: test
  image: python:3.7
  script:
    - pip install "tox>3,<4"
    - tox -e py37

test-py38:
  stage: test
  image: python:3.8
  script:
    - pip install "tox>3,<4"
    - tox -e py38

# only tagged releases
publish:
  stage: deploy
  image: python:3.8
  only:
    - /^v\d+\.\d+\.\d+$/ # eg. "v1.2.3", "v1.0.12" etc.
  except:
    - branches
  environment:
    name: pypi
  script:
    - pip install "twine>1,<2"
    - python setup.py sdist bdist_wheel
    - twine upload dist/*
